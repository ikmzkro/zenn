---
title: "ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼"
emoji: "ğŸŒ²"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["python", "merkletree", "crypto"]
published: false
---

# ä½œã£ãŸã‚‚ã®
https://github.com/ikmzkRo/WLAQ-mint

# ã©ã‚“ãªæ©Ÿèƒ½ï¼Ÿ
NFTã‚’ç™ºè¡Œã™ã‚‹éš›ã€è¤‡æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã„ãã¤ã¾ã§ç™ºè¡Œå¯èƒ½ã‹ã‚’æ˜ç¤ºã—ãŸãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«ç™»éŒ²ã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã«åŸºã¥ã„ã¦NFTãŒç™ºè¡Œå¯èƒ½ã¨ãªã‚‹ã‚ˆã†ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æŠ€è¡“ã‚’é§†ä½¿ã—ã¦åˆ¶å¾¡ã‚’è¡Œã„ã¾ã™ã€‚

ä»Šå›ã¯ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œæ•°ã‚’ç‰¹å®šã®ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã§ç®¡ç†ã™ã‚‹ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

# ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã¨ã¯ä½•ã‹
ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã®åŸºæœ¬æŠ€è¡“ã§ã‚ã‚‹ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®ç†è«–çš„ãªç†è§£ã‚’Pythonã‚’ä½¿ç”¨ã—ã¦é€²ã‚ã¦ã„ãã¾ã™ã€‚

## ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®åŸºæœ¬æ¦‚å¿µ
ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã¯ã€[åŒ…å«è¨¼æ˜](https://zenn.dev/link/comments/75c3f508fb9744)ã‚’åŠ¹ç‡çš„ã«è¡Œã†ãŸã‚ã«è¨­è¨ˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä¸€ä¾‹ã§ã™ã€‚è»½é‡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãªã©ã€å®Œå…¨ãªãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã§ããªã„çŠ¶æ³ã§ã¯ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã‚’ä½¿ç”¨ã—ã¦ãƒ–ãƒ­ãƒƒã‚¯ãƒ˜ãƒƒãƒ€ã®ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®æ•´åˆæ€§ã‚’æ¤œè¨¼ã—ã€å–å¼•ã®å®‰å…¨æ€§ã‚’ç¢ºä¿ã§ãã¾ã™ã€‚

ã“ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¯ã€ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚‹éš›ã«éå¸¸ã«æœ‰ç›Šã§ã™ã€‚ã‚¦ã‚©ãƒ¬ãƒƒãƒˆãŒãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã®å…¨ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹ã¨é…ããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ä»£ã‚ã‚Šã«ãƒ‡ãƒ¼ã‚¿ã®è¦ç´„ã ã‘ã‚’ä¿æŒã—ã¾ã™ã€‚ãŸã ã—ã€ã“ã‚Œã ã‘ã§ã¯è‡ªèº«ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥é–²è¦§ã§ãã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€è‡ªèº«ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ã—ã¦æ”¹ã–ã‚“ã®æœ‰ç„¡ã‚’æ¤œè¨¼ã—ã€ãã®å¾Œå…ƒãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å¿…è¦ãªãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã“ã¨ã§ã€è»½é‡ã§åŠ¹ç‡çš„ã«å–å¼•å±¥æ­´ã‚’ç®¡ç†ã§ãã¾ã™ã€‚

ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æ§‹æˆã¯[ã‚µãƒˆã‚·ãƒŠã‚«ãƒ¢ãƒˆã®è«–æ–‡](https://bitcoin.org/bitcoin.pdf)ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚
![merkletree](/images/merkletree.png)

## ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æ§‹ç¯‰æ‰‹é †
ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ã†ãˆã§å¿…è¦ãªã‚‚ã®ã¯ä»¥ä¸‹ã®2ç‚¹ã§ã™ã€‚
1. ã‚¢ã‚¤ãƒ†ãƒ ã®é †åºä»˜ããƒªã‚¹ãƒˆ: ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã¯ã€ãƒ–ãƒ­ãƒƒã‚¯å†…ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãªã©ã®ã‚¢ã‚¤ãƒ†ãƒ ãŒé †åºä»˜ããƒªã‚¹ãƒˆã¨ã—ã¦æä¾›ã•ã‚Œã‚‹ã“ã¨ã§æ§‹ç¯‰ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ„ãƒªãƒ¼ã®æ§‹é€ ãŒå½¢æˆã•ã‚Œã¾ã™ã€‚
2. æš—å·å­¦çš„ãƒãƒƒã‚·ãƒ¥é–¢æ•°: ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã§ã¯ã€å„ãƒãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ã¯æš—å·å­¦çš„ãƒãƒƒã‚·ãƒ¥é–¢æ•°ã«ã‚ˆã£ã¦ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚Œã¾ã™ã€‚é€šå¸¸ã€hashlib.sha256ã®ã‚ˆã†ãªå®‰å…¨ãªãƒãƒƒã‚·ãƒ¥é–¢æ•°ãŒä½¿ç”¨ã•ã‚Œã€ãã‚Œã«ã‚ˆã£ã¦ãƒ„ãƒªãƒ¼å†…ã®å„ãƒãƒ¼ãƒ‰ãŒä¸€æ„ã®ãƒãƒƒã‚·ãƒ¥å€¤ã‚’æŒã¤ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã‚Œã‚‰ã®è¦ç´ ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚é †åºä»˜ããƒªã‚¹ãƒˆã‹ã‚‰ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–ã‚Šã€ãã‚Œãã‚Œã®ã‚¢ã‚¤ãƒ†ãƒ ã«å¯¾ã—ã¦ãƒãƒƒã‚·ãƒ¥é–¢æ•°ã‚’é©ç”¨ã—ã€ãƒ„ãƒªãƒ¼ã®ä¸Šä½ãƒ¬ãƒ™ãƒ«ã¸ã¨é€²ã‚“ã§ã„ãã“ã¨ã§ã€æœ€çµ‚çš„ã«ä¸€ã¤ã®ãƒ«ãƒ¼ãƒˆãƒãƒƒã‚·ãƒ¥ï¼ˆãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆï¼‰ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã‚’ä½¿ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã«ä»¥ä¸‹ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
1. ãƒãƒƒã‚·ãƒ¥é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã€é †åºä»˜ããƒªã‚¹ãƒˆã®ã‚¢ã‚¤ãƒ†ãƒ å…¨ã¦ã‚’ãƒãƒƒã‚·ãƒ¥åŒ–ã™ã‚‹ã€‚
2. ãƒãƒƒã‚·ãƒ¥ã®å€‹æ•°ãŒ1ã¤ã«ãªã‚Œã°ã€å‡¦ç†ã‚’å®Œäº†ã™ã‚‹ã€‚
3. ãƒãƒƒã‚·ãƒ¥ã®å€‹æ•°ãŒ2ã¤ä»¥ä¸Šã§ã‹ã¤å¥‡æ•°ãªã‚‰ã€æœ«å°¾ã®ãƒãƒƒã‚·ãƒ¥ã‚’è¤‡è£½ã—ã¦å¶æ•°ã«ã™ã‚‹ã€‚
4. ãƒãƒƒã‚·ãƒ¥ã‚’é †ç•ªã«ãƒšã‚¢ã«ã—ã¦ã€é€£çµã—ãŸã‚‚ã®ã‚’ãƒãƒƒã‚·ãƒ¥åŒ–ã—ã¦è¦ªãƒ¬ãƒ™ãƒ«ã®ãƒãƒƒã‚·ãƒ¥ã‚’ç”Ÿæˆã™ã‚‹ã€‚è¦ªãƒ¬ãƒ™ãƒ«ã®ãƒãƒƒã‚·ãƒ¥ã®å€‹æ•°ã¯åŠåˆ†ã«ãªã‚‹ã€‚
5. ç”Ÿæˆã•ã‚ŒãŸãƒãƒƒã‚·ãƒ¥ãŒ1ã¤ã§ãªã‘ã‚Œã°ã€2ã«æˆ»ã‚‹ã€‚

ã“ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã£ã¦å¾—ã‚‰ã‚Œã‚‹ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã¯ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼å…¨ä½“ã®æ•´åˆæ€§ã‚’ç¢ºèªã™ã‚‹éš›ã«æ¥µã‚ã¦é‡è¦ãªè¦ç´ ã§ã™ã€‚ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã¯ã€ã‚¢ã‚¤ãƒ†ãƒ ã®é †åºä»˜ããƒªã‚¹ãƒˆå…¨ä½“ã‚’å˜ä¸€ã®ãƒãƒƒã‚·ãƒ¥ã«ã¾ã¨ã‚ã‚‹æ‰‹æ³•ã§ã‚ã‚Šã€ã“ã®ãƒãƒƒã‚·ãƒ¥ãŒå¤‰æ›´ã•ã‚Œã¦ã„ãªã„é™ã‚Šã€å…ƒã®ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›´ãŒåŠ ãˆã‚‰ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚

## ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®ç”¨èªæ•´ç†
ä»¥ä¸‹ã¯ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã«é–¢ã™ã‚‹ç”¨èªã®æ•´ç†ã§ã™ã€‚
1. ãƒªãƒ¼ãƒ•ï¼šãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æœ€ä¸‹ä½ã«ä½ç½®ã™ã‚‹ãƒãƒ¼ãƒ‰ã§ã€å…ƒã®ãƒ‡ãƒ¼ã‚¿ï¼ˆä¾‹: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã‚’è¡¨ã—ã¾ã™ã€‚å„ãƒªãƒ¼ãƒ•ã¯ãƒãƒƒã‚·ãƒ¥é–¢æ•°ã«ã‚ˆã£ã¦ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚
2. å†…éƒ¨ãƒãƒ¼ãƒ‰ï¼š ãƒªãƒ¼ãƒ•ä»¥å¤–ã®ãƒãƒ¼ãƒ‰ã§ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®ä¸­é–“ãƒ¬ãƒ™ãƒ«ã«ä½ç½®ã—ã¾ã™ã€‚å†…éƒ¨ãƒãƒ¼ãƒ‰ã¯ãƒªãƒ¼ãƒ•ã‚„ä»–ã®å†…éƒ¨ãƒãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥ã‹ã‚‰è¨ˆç®—ã•ã‚Œã¾ã™ã€‚
3. ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆï¼šãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æœ€ä¸Šä½ã«ã‚ã‚‹ãƒãƒ¼ãƒ‰ã§ã€å…¨ä½“ã®æ•´åˆæ€§ã‚’ç¤ºã™å˜ä¸€ã®ãƒãƒƒã‚·ãƒ¥ã§ã™ã€‚ã“ã‚ŒãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼å…¨ä½“ã®å¤‰æ›´ãŒæ¤œçŸ¥ã•ã‚Œã¾ã™ã€‚
4. ãƒãƒ¼ã‚¯ãƒ«ãƒšã‚¢ãƒ¬ãƒ³ãƒˆ:  äºŒã¤ã®ãƒãƒƒã‚·ãƒ¥ã‚’å–ã‚Šã€ãã‚Œã‚‰ã‚’é€£çµã—ã¦ãƒãƒƒã‚·ãƒ¥åŒ–ã—ãŸã‚‚ã®ã§ã™ã€‚ã“ã®æ“ä½œã«ã‚ˆã‚Šã€æ–°ã—ã„ãƒãƒ¼ãƒ‰ï¼ˆè¦ªãƒãƒ¼ãƒ‰ï¼‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚
5. ãƒãƒ¼ã‚¯ãƒ«ãƒšã‚¢ãƒ¬ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«: ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã«ãŠã„ã¦ã€å„ãƒšã‚¢ã®è¦ªãƒãƒƒã‚·ãƒ¥ã‚’å¾—ã‚‹ãŸã‚ã®ç‰¹å®šã®ãƒ¬ãƒ™ãƒ«ã€‚é€šå¸¸ã€é †åºä»˜ããƒãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆãŒ3ã¤ä»¥ä¸Šå­˜åœ¨ã™ã‚‹å ´åˆã«ãƒãƒ¼ã‚¯ãƒ«ãƒšã‚¢ãƒ¬ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ãŒå½¢æˆã•ã‚Œã¾ã™ã€‚
6. ãƒãƒ¼ã‚¯ãƒ«ãƒ‘ã‚¹: ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®ãƒ«ãƒ¼ãƒˆã‹ã‚‰ãƒªãƒ¼ãƒ•ã¾ã§ã®æœ€çŸ­çµŒè·¯ã«å«ã¾ã‚Œã‚‹ãƒãƒƒã‚·ãƒ¥å€¤ã®åˆ—ã€‚ã“ã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ç‰¹å®šã®ãƒªãƒ¼ãƒ•ãŒãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã«æ­£ã—ãçµã³ã¤ã„ã¦ã„ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã§ãã¾ã™ã€‚
7. ãƒãƒ¼ã‚¯ãƒ«ãƒ—ãƒ«ãƒ¼ãƒ•: ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®ãƒ«ãƒ¼ãƒˆã‹ã‚‰å¯¾è±¡ã®ãƒãƒ¼ãƒ‰ã¾ã§ã®ãƒ‘ã‚¹ã‚’ç¤ºã™æƒ…å ±ã§ã€å¯¾è±¡ãŒãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼å†…ã«å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ã®ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã‚’å†åº¦è¨ˆç®—ã—ãƒ‡ãƒ¼ã‚¿ã®æœ‰åŠ¹æ€§ã‚’è¨¼æ˜ã—ã¾ã™ã€‚

## ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹
:::details ãƒãƒ¼ã‚¯ãƒ«ãƒšã‚¢ãƒ¬ãƒ³ãƒˆã‚’æ±‚ã‚ã‚‹
```py: main.py
from helper import hash256

leftHash = bytes.fromhex('c117ea8ec828342f4dfb0ad6bd140e03a50720ece40169ee38bdc15d9eb64cf5')
rightHash = bytes.fromhex('c131474164b412e3406696da1ee20ab0fc9bf41c8f05fa8ceea7a08d672d7cc5')
parent = hash256(leftHash + rightHash)

print(parent.hex())
```
å‡ºåŠ›:
```
8b30c5ba100f6f2e5ad1e2a742e5020491240f8eb514fe97c713c31718ad7ecd
```
:::
ãƒãƒƒã‚·ãƒ¥ã‚’ãƒšã‚¢ã«ã—ã€æ–°ã—ã„ãƒãƒƒã‚·ãƒ¥ã‚’ç”Ÿæˆã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ã€é€šå¸¸ã€å·¦å´ã®ãƒãƒƒã‚·ãƒ¥ï¼ˆLï¼‰ã¨å³å´ã®ãƒãƒƒã‚·ãƒ¥ï¼ˆRï¼‰ã¨ã—ã¦ã€ãã‚Œã‚‰ã‚’é€£çµã—ãŸçµæœã‚’è¦ªãƒãƒƒã‚·ãƒ¥ï¼ˆPï¼‰ã¾ãŸã¯ãƒãƒ¼ã‚¯ãƒ«ãƒšã‚¢ãƒ¬ãƒ³ãƒˆã¨å‘¼ã³ã¾ã™ã€‚
```
P = H(L||R)ã€€â€»||ã¯é€£çµ
```

:::details ãƒãƒ¼ã‚¯ãƒ«ãƒšã‚¢ãƒ¬ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã«å¯¾å¿œã™ã‚‹æ–°ãŸãªãƒãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆã‚’æ±‚ã‚ã‚‹
```py: main.py
# é †åºä»˜ããƒãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆã‚’ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã—ã¦ãƒãƒƒã‚·ãƒ¥åŒ–
hex_hashes = [
    'c117ea8ec828342f4dfb0ad6bd140e03a50720ece40169ee38bdc15d9eb64cf5',
    'c131474164b412e3406696da1ee20ab0fc9bf41c8f05fa8ceea7a08d672d7cc5',
    'f391da6ecfeed1814efae39e7fcb3838ae0b02c02ae7d0a5848a66947c0727b0',
    '3d238a92a94532b946c90e19c49351c763696cff3db400485b813aecb8a13181',
    '10092f2633be5f3ce349bf9ddbde36caa3dd10dfa0ec8106bce23acbff637dae',
]
hashes = [bytes.fromhex(x) for x in hex_hashes]

# ãƒãƒƒã‚·ãƒ¥æ•°ãŒå¥‡æ•°ãªã‚‰æœ«å°¾ã®ãƒãƒƒã‚·ãƒ¥å€¤ã‚’è¤‡è£½ã—ã¦é€£çµ
if len(hashes) % 2 == 1:
    hashes.append(hashes[-1])

# ãƒãƒ¼ã‚¯ãƒ«ãƒšã‚¢ãƒ¬ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«
parent_level = []

# ãƒãƒƒã‚·ãƒ¥å€¤ã‚’ï¼’ã¤ãšã¤é¸æŠã—ã¦ãƒšã‚¢ã‚’ä½œæˆ
for i in range(0, len(hashes), 2):
    parent = merkle_parent(hashes[i], hashes[i+1])
    parent_level.append(parent)
for item in parent_level:
    print(item.hex())
```
å‡ºåŠ›:
```
8b30c5ba100f6f2e5ad1e2a742e5020491240f8eb514fe97c713c31718ad7ecd
7f4e6f9e224e20fda0ae4c44114237f97cd35aca38d83081c9bfd41feb907800
3ecf6115380c77e8aae56660f5634982ee897351ba906a6837d15ebc3a225df0
```
:::
ãƒãƒƒã‚·ãƒ¥ã®å€‹æ•°ãŒå¥‡æ•°ã®å ´åˆã€æœ«å°¾ã®ãƒãƒƒã‚·ãƒ¥ã‚’è¤‡è£½ã—ã¦å¶æ•°ã«èª¿æ•´ã—ã€ãã‚Œã‹ã‚‰ãƒãƒƒã‚·ãƒ¥ã‚’ãƒšã‚¢ã«ã—ã¦é€£çµã—ã¦æ–°ã—ã„ãƒãƒƒã‚·ãƒ¥ã‚’ç”Ÿæˆã™ã‚‹æ‰‹é †ã¯ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æ§‹ç¯‰ã«ãŠã„ã¦ä¸€èˆ¬çš„ãªå‡¦ç†ã§ã™ã€‚ä¾‹ã¨ã—ã¦ã€5ã¤ã®ãƒãƒƒã‚·ãƒ¥ã‹ã‚‰å§‹ã‚ã€æœ«å°¾ã®ãƒãƒƒã‚·ãƒ¥ã‚’è¤‡è£½ã—ã¦ãƒãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆã‚’å¶æ•°ã«æ•´ç†ã—ãŸå¾Œã€ãƒšã‚¢ã‚’ä½œæˆã—ã¦é€£çµã™ã‚‹ã¨ã€æœ€çµ‚çš„ã«è¦ç´ æ•°3ã®ãƒãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆãŒå¾—ã‚‰ã‚Œã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¾ã™ã€‚


:::details ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã‚’æ±‚ã‚ã‚‹
```py: main.py
from helper import merkle_parent_level
hex_hashes = [
    'c117ea8ec828342f4dfb0ad6bd140e03a50720ece40169ee38bdc15d9eb64cf5',
    'c131474164b412e3406696da1ee20ab0fc9bf41c8f05fa8ceea7a08d672d7cc5',
    'f391da6ecfeed1814efae39e7fcb3838ae0b02c02ae7d0a5848a66947c0727b0',
    '3d238a92a94532b946c90e19c49351c763696cff3db400485b813aecb8a13181',
    '10092f2633be5f3ce349bf9ddbde36caa3dd10dfa0ec8106bce23acbff637dae',
    '7d37b3d54fa6a64869084bfd2e831309118b9e833610e6228adacdbd1b4ba161',
    '8118a77e542892fe15ae3fc771a4abfd2f5d5d5997544c3487ac36b5c85170fc',
    'dff6879848c2c9b62fe652720b8df5272093acfaa45a43cdb3696fe2466a3877',
    'b825c0745f46ac58f7d3759e6dc535a1fec7820377f24d4c2c6ad2cc55c0cb59',
    '95513952a04bd8992721e9b7e2937f1c04ba31e0469fbe615a78197f68f52b7c',
    '2e6d722e5e4dbdf2447ddecc9f7dabb8e299bae921c99ad5b0184cd9eb8e5908',
    'b13a750047bc0bdceb2473e5fe488c2596d7a7124b4e716fdd29b046ef99bbf0',
]
hashes = [bytes.fromhex(x) for x in hex_hashes]
current_hashes = hashes
while len(current_hashes) > 1:
    current_hashes = merkle_parent_level(current_hashes)
print(current_hashes[0].hex())
```
å‡ºåŠ›:
```
acbcab8bcc1af95d8d563b77d24c3d19b18f1486383d75a5085c4e86c86beed6
```
:::
while ãƒ«ãƒ¼ãƒ—ã®ç¹°ã‚Šè¿”ã—æ¡ä»¶ã¨ã—ã¦ãƒãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆã®é•·ã•ãŒ1ã‚ˆã‚Šå¤§ãã„ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã€é•·ã•ãŒ1ã«ãªã‚Œã°ãƒ«ãƒ¼ãƒ—ã‚’çµ‚äº†ã—ã¾ã™ã€‚

:::details ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æ§‹é€ ã‚’æŠŠæ¡ã™ã‚‹
```py: main.py
import math

# ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æ§‹é€ ã‚’æŠŠæ¡
from helper import validate_merkle_root

# ãƒªãƒ¼ãƒ•æ•°ã¯16ï¼ˆè»½é‡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæœ€åˆã«å¿…è¦ãªæƒ…å ±ï¼‰
total = 16

# äºŒåˆ†æœ¨æ¢ç´¢æ–¹æ³•ã«å¿…è¦ãªæ·±ã•ã‚’æ±‚ã‚ã‚‹ï¼ˆã“ã“ã§ã¯log2^16=4ï¼‰
max_depth = math.ceil(math.log(total, 2))
merkle_tree = []
for depth in range(max_depth + 1):
    num_items = math.ceil(total / 2**(max_depth - depth))
    level_hashes = [None] * num_items
    merkle_tree.append(level_hashes)
for level in merkle_tree:
    print(level)
```
å‡ºåŠ›:
```
[None]
[None, None]
[None, None, None, None]
[None, None, None, None, None, None, None, None]
[None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None]
```
:::
è»½é‡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒ•ãƒ«ãƒãƒ¼ãƒ‰ã‹ã‚‰å—ä¿¡ã™ã‚‹æƒ…å ±ã®ä¸­ã§ã€å¿…è¦ãªã®ã¯ãƒªãƒ¼ãƒ•æ•°ï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ•°ï¼‰ã§ã™ã€‚ã“ã‚Œã¯ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æ§‹é€ ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®åŸºæœ¬çš„ãªæƒ…å ±ã§ã‚ã‚Šã€ãƒªãƒ¼ãƒ•æ•°ã‚’çŸ¥ã‚‹ã“ã¨ã§ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æ·±ã•ã‚’è¨ˆç®—ã§ãã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æ·±ã•ã¯ log2^(ãƒªãƒ¼ãƒ•æ•°) ã§æŠŠæ¡ã§ãã¾ã™ã€‚ãã—ã¦ã€ã“ã®æ·±ã•æƒ…å ±ã‚’ for ãƒ«ãƒ¼ãƒ—ã®ç¹°ã‚Šè¿”ã—æ¡ä»¶ã«åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

:::details ãƒãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆã‚’æŒ‡å®šã—ã¦ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æ§‹é€ ã‚’æŠŠæ¡ã™ã‚‹
```py: main.py
from merkleblock import MerkleTree
from helper import merkle_parent_level
hex_hashes = [
    "9745f7173ef14ee4155722d1cbf13304339fd00d900b759c6f9d58579b5765fb",
    "5573c8ede34936c29cdfdfe743f7f5fdfbd4f54ba0705259e62f39917065cb9b",
    "82a02ecbb6623b4274dfcab82b336dc017a27136e08521091e443e62582e8f05",
    "507ccae5ed9b340363a0e6d765af148be9cb1c8766ccc922f83e4ae681658308",
    "a7a4aec28e7162e1e9ef33dfa30f0bc0526e6cf4b11a576f6c5de58593898330",
    "bb6267664bd833fd9fc82582853ab144fece26b7a8a5bf328f8a059445b59add",
    "ea6d7ac1ee77fbacee58fc717b990c4fcccf1b19af43103c090f601677fd8836",
    "457743861de496c429912558a106b810b0507975a49773228aa788df40730d41",
    "7688029288efc9e9a0011c960a6ed9e5466581abf3e3a6c26ee317461add619a",
    "b1ae7f15836cb2286cdd4e2c37bf9bb7da0a2846d06867a429f654b2e7f383c9",
    "9b74f89fa3f93e71ff2c241f32945d877281a6a50a6bf94adac002980aafe5ab",
    "b3a92b5b255019bdaf754875633c2de9fec2ab03e6b8ce669d07cb5b18804638",
    "b5c0b915312b9bdaedd2b86aa2d0f8feffc73a2d37668fd9010179261e25e263",
    "c9d52c5cb1e557b92c84c52e7c4bfbce859408bedffc8a5560fd6e35e10b8800",
    "c555bc5fc3bc096df0a0c9532f07640bfb76bfe4fc1ace214b8b228a1297a4c2",
    "f9dbfafc3af3400954975da24eb325e326960a25b87fffe23eef3e7ed2fb610e",
]
tree = MerkleTree(len(hex_hashes))
tree.nodes[4] = [bytes.fromhex(h) for h in hex_hashes]
tree.nodes[3] = merkle_parent_level(tree.nodes[4])
tree.nodes[2] = merkle_parent_level(tree.nodes[3])
tree.nodes[1] = merkle_parent_level(tree.nodes[2])
tree.nodes[0] = merkle_parent_level(tree.nodes[1])

print(tree)
```
å‡ºåŠ›:
```
*597c4baf.*
6382df3f..., 87cf8fa3...
3ba6c080..., 8e894862..., 7ab01bb6..., 3df760ac...
272945ec..., 9a38d037..., 4a64abd9..., ec7c95e1..., 3b67006c..., 850683df..., d40d268b..., 8636b7a3...
9745f717..., 5573c8ed..., 82a02ecb..., 507ccae5..., a7a4aec2..., bb626766..., ea6d7ac1..., 45774386..., 76880292..., b1ae7f15..., 9b74f89f..., b3a92b5b..., b5c0b915..., c9d52c5c..., c555bc5f..., f9dbfafc...
```
:::
ãƒãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã¨ãã®æœ€ä¸Šä½ã«ã‚ã‚‹ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã€ã“ã‚Œã«ã‚ˆã£ã¦ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’è¦–èªã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

:::details ãƒãƒ¼ã‚¯ãƒ«ãƒ‘ã‚¹ã®æ¢ç´¢ï¼ˆå¶æ•°ãƒ»å¥‡æ•°ï¼‰
å¶æ•°
```py: main.py
from merkleblock import MerkleTree
from helper import merkle_parent
hex_hashes = [
    "9745f7173ef14ee4155722d1cbf13304339fd00d900b759c6f9d58579b5765fb",
    "5573c8ede34936c29cdfdfe743f7f5fdfbd4f54ba0705259e62f39917065cb9b",
    "82a02ecbb6623b4274dfcab82b336dc017a27136e08521091e443e62582e8f05",
    "507ccae5ed9b340363a0e6d765af148be9cb1c8766ccc922f83e4ae681658308",
]
tree = MerkleTree(len(hex_hashes))
tree.nodes[2] = [bytes.fromhex(h) for h in hex_hashes]
while tree.root() is None:
    if tree.is_leaf():
        tree.up()
    else:
        left_hash = tree.get_left_node()
        if left_hash is None:
            tree.left()
        elif tree.right_exists():
            right_hash = tree.get_right_node()
            if right_hash is None:
                tree.right()
            else:
                tree.set_current_node(merkle_parent(left_hash, right_hash))
                tree.up()
        else:
            tree.set_current_node(merkle_parent(left_hash, left_hash))
            tree.up()
print(tree)
```
å‡ºåŠ›:
```
3ba6c080...
272945ec..., 9a38d037...
9745f717..., 5573c8ed..., 82a02ecb..., 507ccae5...
```

å¥‡æ•°
```py: main.py
from merkleblock import MerkleTree
from helper import merkle_parent
hex_hashes = [
    "9745f7173ef14ee4155722d1cbf13304339fd00d900b759c6f9d58579b5765fb",
    "5573c8ede34936c29cdfdfe743f7f5fdfbd4f54ba0705259e62f39917065cb9b",
    "82a02ecbb6623b4274dfcab82b336dc017a27136e08521091e443e62582e8f05",
]
tree = MerkleTree(len(hex_hashes))
tree.nodes[2] = [bytes.fromhex(h) for h in hex_hashes]
while tree.root() is None:
    if tree.is_leaf():
        tree.up()
    else:
        left_hash = tree.get_left_node()
        if left_hash is None:
            tree.left()
        elif tree.right_exists():
            right_hash = tree.get_right_node()
            if right_hash is None:
                tree.right()
            else:
                tree.set_current_node(merkle_parent(left_hash, right_hash))
                tree.up()
        else:
            tree.set_current_node(merkle_parent(left_hash, left_hash))
            tree.up()
print(tree)
```
å‡ºåŠ›:
```
a779fe9f...
272945ec..., bdca1c60...
9745f717..., 5573c8ed..., 82a02ecb...
```
:::
ãƒã‚¤ãƒŠãƒªãƒ„ãƒªãƒ¼ï¼ˆäºŒåˆ†æœ¨ï¼‰ã®èµ°æŸ»ã«ã¯ä¸»ã«2ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã‚ã‚Šã¾ã™: å¹…å„ªå…ˆæ¢ç´¢ã¨æ·±ã•å„ªå…ˆæ¢ç´¢ã€‚

1. å¹…å„ªå…ˆæ¢ç´¢ (Breadth-First Search, BFS): ãƒ¬ãƒ™ãƒ«ã”ã¨ã«å·¦ã‹ã‚‰å³ã«é€²ã‚“ã§ã„ãæ¢ç´¢æ–¹æ³•ã§ã™ã€‚åŒã˜ãƒ¬ãƒ™ãƒ«ã®ãƒãƒ¼ãƒ‰ã‚’å…¨ã¦èª¿æŸ»ã—ã¦ã‹ã‚‰ã€æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã«é€²ã¿ã¾ã™ã€‚å¹…å„ªå…ˆæ¢ç´¢ã¯é€šå¸¸ã€ã‚­ãƒ¥ãƒ¼ã‚’ä½¿ç”¨ã—ã¦å®Ÿè£…ã•ã‚Œã¾ã™ã€‚
2. æ·±ã•å„ªå…ˆæ¢ç´¢ (Depth-First Search, DFS): å„ãƒãƒ¼ãƒ‰ã«ãŠã‘ã‚‹å­ãƒãƒƒã‚·ãƒ¥ã®ã†ã¡ã€ã‚ã‚‹æ–¹å‘ï¼ˆé€šå¸¸å·¦ï¼‰ã«é€²ã‚“ã§ã‹ã‚‰ã€ä»–ã®æ–¹å‘ã«é€²ã‚€æ¢ç´¢æ–¹æ³•ã§ã™ã€‚æ·±ã•å„ªå…ˆæ¢ç´¢ã¯é€šå¸¸ã€å†å¸°ã‚’ä½¿ç”¨ã—ã¦å®Ÿè£…ã•ã‚Œã¾ã™ã€‚

ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æ§‹ç¯‰ã«ãŠã„ã¦ã¯ã€é€šå¸¸æ·±ã•å„ªå…ˆæ¢ç´¢ãŒæ¡ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒªãƒ¼ãƒ•ã«åˆ°é”ã™ã‚‹ã¨è¦ªãƒãƒƒã‚·ãƒ¥ã«æˆ»ã‚‹å¿…è¦ãŒãªãã€ã¾ãŸãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æ§‹é€ ã«ãŠã„ã¦æ·±ã•å„ªå…ˆæ¢ç´¢ãŒéƒ½åˆãŒè‰¯ã„ã‹ã‚‰ã§ã™ã€‚ç‰¹ã«ã€ãƒªãƒ¼ãƒ•ãŒå¥‡æ•°ã®å ´åˆã§ã‚‚ã€æ·±ã•å„ªå…ˆæ¢ç´¢ã§ã¯ã‚¹ãƒ ãƒ¼ã‚ºã«å‡¦ç†ã§ãã¾ã™ã€‚

å®Ÿè£…ã«ãŠã„ã¦ã¯ã€å†å¸°ã‚„æ˜ç¤ºçš„ãªã‚¹ã‚¿ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦æ·±ã•å„ªå…ˆæ¢ç´¢ã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ãŒä¸€èˆ¬çš„ã§ã™ã€‚

## ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã‚’æ¤œè¨¼ã™ã‚‹
ã“ã‚Œã¾ã§ã®ã‚³ãƒ¼ãƒ‰ã§ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æ§‹ç¯‰ãŒç¢ºèªã§ãã¾ã—ãŸã€‚æœ¬é …ã§ã¯ã€ã“ã‚Œã¾ã§ã®çŸ¥è­˜ã‚’æ•´ç†ã—ã€æŠ€è¡“æ¤œè¨¼ã‚’é€²ã‚ã¾ã™ã€‚

:::details ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã®å°å‡º
```py: verify.py
class Tree:
    def __init__(self, leaves):
        self.leaves = [Node(leaf) for leaf in leaves]
        self.layer  = self.leaves[::]
        self.root   = None
        self.build_tree()
```
å…¥åŠ›:
```
block = ["ã‚ã‚", "ã‚ã‚", "ã¿ã‹ã‚“", "ã¿ã‹ã‚“", "ã¿ã‹ã‚“", "ã‚Šã‚“ã”", "ã‚Šã‚“ã”", "ã©ãƒ¼ãªã£ã¤", "ã©ãƒ¼ãªã£ã¤"]
print(block)

merkletree = Tree(block)

merkle_root = merkletree.root
print(merkle_root)
```
å‡ºåŠ›:
```
bf03b42cf8e4e8581e08c7595775dc2d9d79c34f9b95885a5d42df100786a218
```
:::
ã“ã®ãƒªã‚¹ãƒˆã¯ãƒ–ãƒ­ãƒƒã‚¯å†…ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã«å¯¾ã™ã‚‹ãƒãƒ¼ã‚¯ãƒ«ãƒ‘ã‚¹ã§ã‚ã‚Šã€æœ€çµ‚çš„ã«æ±‚ã¾ã£ãŸãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã¯ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã«ãŠã„ã¦ãã®ãƒ–ãƒ­ãƒƒã‚¯å†…ã®å…¨ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®æ•´åˆæ€§ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®é‡è¦ãªæƒ…å ±ã§ã™ã€‚

ã‚¦ã‚©ãƒ¬ãƒƒãƒˆãŒãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã‚’ç”¨ã„ã¦ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã‚’è¨ˆç®—ã—ã€ãã‚ŒãŒãƒ–ãƒ­ãƒƒã‚¯ãƒ˜ãƒƒãƒ€ã®ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã¨ä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ã€ãƒ–ãƒ­ãƒƒã‚¯å†…ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒæ”¹ã–ã‚“ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’æ¤œè¨¼ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã¯åŠ¹ç‡çš„ã«è‡ªèº«ã®æ®‹é«˜ã‚„ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®æ•´åˆæ€§ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

:::details ãƒãƒ¼ã‚¯ãƒ«ãƒ‘ã‚¹ã®æ¢ç´¢
```py: verify.py
def search(self, data):
    target = None
    hash_value = sha256(data.encode()).hexdigest()
    for node in self.leaves:
        if node.hash == hash_value:
            target = node
    return target

def get_pass(self, data):
    target = self.search(data)
    markle_pass = []
    if not(target):
        return
    markle_pass.append(target.hash)
    while target.parent:
        sibling = target.sibling
        markle_pass.append((sibling.hash, sibling.position))
        target = target.parent
    return markle_pass   
```
å…¥åŠ›:
```
merkle_pass = merkletree.get_pass("ã¿ã‹ã‚“")
print(merkle_pass)
```
å‡ºåŠ›:
```
['1cbe93b936a4bd4d40c2224462023917cd77c962376feb9128d9e569c9856aaf', ('4261abfc91324dc5319312592125610a16b0b0a996fcdfae1d24766b918afae9', 'right'), ('0a6b2aa3a1fc41a9394c48adbf1cb1c3eb3e3a9db975906fb743308f23e1f15b', 'right'), ('2165f2270bbe8ce292395df14cb4e65e271fe608013c018d6b5864ec9f1865c8', 'left'), ('94f4c2ba6d697dc41109e2194343bf721e2bbc5de48068609578c0f4ba5481ed', 'right')]
```
:::
merkle_pass ã‚’æ±‚ã‚ã‚‹ã¨"ã¿ã‹ã‚“"ãƒãƒ¼ãƒ‰ã‹ã‚‰ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®ãƒ«ãƒ¼ãƒˆã¾ã§ã®çµŒè·¯ãŒç¤ºã•ã‚Œã¾ã™ã€‚ã“ã®ãƒãƒ¼ã‚¯ãƒ«ãƒ‘ã‚¹ã‚’ä½¿ã†ã“ã¨ã§ã€ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ãŒãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼å†…ã§æ­£å½“ãªä½ç½®ã«ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã§ãã¾ã™ã€‚

0. `1cbe93b936a4bd4d40c2224462023917cd77c962376feb9128d9e569c9856aaf`: "ã¿ã‹ã‚“"ãƒãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥å€¤
1. `('4261abfc91324dc5319312592125610a16b0b0a996fcdfae1d24766b918afae9', 'right')`: "ã¿ã‹ã‚“"ãƒãƒ¼ãƒ‰ã®è¦ªãƒãƒ¼ãƒ‰ã®å³å´ã«ã‚ã‚‹å…„å¼Ÿãƒãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥å€¤ã¨ãã®ä½ç½®æƒ…å ±ã€‚"ã¿ã‹ã‚“"ãƒãƒ¼ãƒ‰ã¨ãã®å…„å¼Ÿãƒãƒ¼ãƒ‰ï¼ˆå³å´ã®ãƒãƒ¼ãƒ‰ï¼‰ã®ãƒãƒƒã‚·ãƒ¥ã‚’é€£çµã—ã¦è¦ªãƒãƒ¼ãƒ‰ã‚’ä½œã‚Šã€ãã®ãƒãƒƒã‚·ãƒ¥ãŒã“ã®è¦ç´ ã«ãªã‚Šã¾ã™ã€‚
2. `('0a6b2aa3a1fc41a9394c48adbf1cb1c3eb3e3a9db975906fb743308f23e1f15b', 'right')`: ã“ã‚Œã¯ä¸Šè¨˜ã®ãƒãƒ¼ãƒ‰ï¼ˆè¦ªãƒãƒ¼ãƒ‰ã®å³å´ã®ãƒãƒ¼ãƒ‰ï¼‰ã®è¦ªãƒãƒ¼ãƒ‰ã®å³å´ã«ã‚ã‚‹å…„å¼Ÿãƒãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥å€¤ã¨ãã®ä½ç½®æƒ…å ±ã§ã™ã€‚åŒæ§˜ã«ã€ãƒãƒƒã‚·ãƒ¥ã‚’é€£çµã—ã¦è¦ªãƒãƒ¼ãƒ‰ã‚’ä½œã‚Šã€ãã®ãƒãƒƒã‚·ãƒ¥ãŒã“ã®è¦ç´ ã«ãªã‚Šã¾ã™ã€‚
3. `('2165f2270bbe8ce292395df14cb4e65e271fe608013c018d6b5864ec9f1865c8', 'left')`: åŒæ§˜ã®èª¬æ˜ã§ã€ã“ã‚Œã¯ä¸Šè¨˜ãƒãƒ¼ãƒ‰ã®è¦ªãƒãƒ¼ãƒ‰ã®å·¦å´ã«ã‚ã‚‹å…„å¼Ÿãƒãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥å€¤ã¨ãã®ä½ç½®æƒ…å ±ã§ã™ã€‚
4. `('94f4c2ba6d697dc41109e2194343bf721e2bbc5de48068609578c0f4ba5481ed', 'right')`: åŒæ§˜ã®èª¬æ˜ã§ã€ã“ã‚Œã¯ä¸Šè¨˜ãƒãƒ¼ãƒ‰ã®è¦ªãƒãƒ¼ãƒ‰ã®å³å´ã«ã‚ã‚‹å…„å¼Ÿãƒãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥å€¤ã¨ãã®ä½ç½®æƒ…å ±ã§ã™ã€‚

ã“ã‚Œã‚‰ã®è¦ç´ ã‚’ãŸã©ã‚‹ã“ã¨ã§ã€"ã¿ã‹ã‚“" ãƒãƒ¼ãƒ‰ã‹ã‚‰ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®ãƒ«ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ã¾ã§ã®çµŒè·¯ãŒç¤ºã•ã‚Œã¾ã™ã€‚

:::details ãƒãƒ¼ã‚¯ãƒ«ãƒ‘ã‚¹ã®æ¤œè¨¼
```py: verify.py
def caluculator(markle_pass):
    value = markle_pass[0]
    for node in markle_pass[1:]:
        sib = node[0]
        position = node[1]
        if position == "right":
            value = sha256(value.encode() + sib.encode()).hexdigest()
        else:
            value = sha256(sib.encode() + value.encode()).hexdigest()
    return value   
```
å…¥åŠ›:
```
candidate = caluculator(merkle_pass)
print(candidate)
```
å‡ºåŠ›:
```
bf03b42cf8e4e8581e08c7595775dc2d9d79c34f9b95885a5d42df100786a218
```
:::
ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã¨ãã®ãƒãƒ¼ã‚¯ãƒ«ãƒ‘ã‚¹ã‚’ä½¿ç”¨ã—ã¦ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®æ•´åˆæ€§ã‚’ç¢ºèªã—ã€æœ€çµ‚çš„ã«ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆãŒä¸€è‡´ã™ã‚‹ã“ã¨ã§æ”¹ã–ã‚“ãŒè¡Œã‚ã‚Œã¦ã„ãªã„ã“ã¨ã‚’æ¤œè¨¼ã§ãã¾ã—ãŸã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€è»½é‡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã¯å…¨ä½“ã®ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã›ãšã«ã€ç‰¹å®šã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®æ•´åˆæ€§ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨ã„ã†ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚


:::details ãƒãƒ¼ã‚¯ãƒ«ãƒ‘ã‚¹ã®æ¤œè¨¼
```py: verify.py
def caluculator(markle_pass):
    value = markle_pass[0]
    for node in markle_pass[1:]:
        sib = node[0]
        position = node[1]
        if position == "right":
            value = sha256(value.encode() + sib.encode()).hexdigest()
        else:
            value = sha256(sib.encode() + value.encode()).hexdigest()
    return value   
```
å…¥åŠ›:
```
block = ["ã‚ã‚", "ã‚ã‚", "ã¿ã‹ã‚“", "ã¿ã‹ã‚“", "ã‚Šã‚“ã”", "ã‚Šã‚“ã”", "ã©ãƒ¼ãªã£ã¤", "ã©ãƒ¼ãªã£ã¤"]
print(block)

merkletree = Tree(block)

merkle_pass = merkletree.get_pass("ã¿ã‹ã‚“")
print(merkle_pass)

candidate = caluculator(merkle_pass)
print(candidate)

merkle_root = merkletree.root
print(merkle_root)
```
å‡ºåŠ›:
```
['ã‚ã‚', 'ã‚ã‚', 'ã¿ã‹ã‚“', 'ã¿ã‹ã‚“', 'ã‚Šã‚“ã”', 'ã‚Šã‚“ã”', 'ã©ãƒ¼ãªã£ã¤', 'ã©ãƒ¼ãªã£ã¤']
['1cbe93b936a4bd4d40c2224462023917cd77c962376feb9128d9e569c9856aaf', ('1cbe93b936a4bd4d40c2224462023917cd77c962376feb9128d9e569c9856aaf', 'left'), ('aa280a624da2b88334623a7033f5a6eac1da7012ace335a6366828f59377ed1b', 'left'), ('4d8a97b9474b34c013c92ba1662bb98ae8cab97681ae21b9843db45ee2854730', 'right')]
b8cc63db762632990e49bea7832293ae2d18cff643c78c1e2274c7fcf757354a
b8cc63db762632990e49bea7832293ae2d18cff643c78c1e2274c7fcf757354a
```
:::
æœ€å¾Œã«ãƒ–ãƒ­ãƒƒã‚¯ã®å†…å®¹ã‚’æ”¹ã–ã‚“ã—ã¦ã¿ã¦ã€ãã‚Œã«ã‚ˆã£ã¦ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®æ•´åˆæ€§ãŒæãªã‚ã‚Œã€ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆãŒç•°ãªã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚
ã¿ã‹ã‚“ã‚’1ã¤é£Ÿã¹ã¦è¦ç´ ã‚’1ã¤å°‘ãªãã—ã¾ã™ã€‚
ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã‹ã‚‰ãƒãƒ¼ã‚¯ãƒ«ãƒ‘ã‚¹ã‚’å–å¾—ã—ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã‚’ç®—å‡ºã™ã‚‹ã¨ã€æ”¹ã–ã‚“å‰ã®ãƒ„ãƒªãƒ¼ã®ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã¨ç•°ãªã‚‹äº‹ãŒç¢ºèªã§ãã¾ã™ã€‚

- æ”¹ã–ã‚“å‰: `bf03b42cf8e4e8581e08c7595775dc2d9d79c34f9b95885a5d42df100786a218`
- æ”¹ã–ã‚“å¾Œ: `b8cc63db762632990e49bea7832293ae2d18cff643c78c1e2274c7fcf757354a`


# ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆé–‹ç™ºã¨ãƒ‡ãƒ—ãƒ­ã‚¤
ã“ã“ã¾ã§ã®ç†è«–çš„ãªç†è§£ã‚’è¸ã¾ãˆã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã‚’ç”¨ã„ãŸãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆä»˜ãã®ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

## ã‚³ãƒ¼ãƒ‰ã®è²¬å‹™
ã‚³ãƒ¼ãƒ‰ã®è²¬å‹™ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚
| ãƒ•ã‚¡ã‚¤ãƒ«                  | èª¬æ˜                                                |
| ------------------------- | --------------------------------------------------- |
| `contracts/WLAQ.sol`      | ãƒãƒ¼ã‚¯ãƒ«ãƒ—ãƒ«ãƒ¼ãƒ•èªè¨¼ã‚’è¡Œã„ã€ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œã‚’è¡Œã†ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ   |
| `test/WLAQ.ts`            | `contracts/WLAQ.sol`ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰                    |
| `utils/data.ts`           | ãƒ›ãƒ¯ã‚¤ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç™»éŒ²ã™ã‚‹ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„æ•°é‡ã®å®šç¾©        |
| `utils/interfaces.ts`     | å‹å®šç¾©                                              |
| `utils/merkletree.ts`     | ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹é–¢æ•°                           |
| `scripts/deploy.ts`       | `contracts/WLAQ.sol`ã‚’ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ    |

## ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ
ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ã€è¨ˆç®—çµæœã®ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã‚’è¨­å®šã—ã¾ã™ã€‚
```sol
constructor(bytes32 merkleRoot_) ERC721('Zutto Mayonakade Iinoni', 'ZTMY') {
    merkleRoot = merkleRoot_;
}
```

ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆå†…ã§ã®MerkleProofèªè¨¼ã«ã¯ã€`@openzeppelin/contracts/utils/cryptography/MerkleProof.sol`ã§æä¾›ã•ã‚Œã¦ã„ã‚‹é–¢æ•°ã‚’æ´»ç”¨ã—ã¾ã™ã€‚

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ­£å¸¸ã«é€šéã—ãŸå ´åˆï¼ˆã¤ã¾ã‚Šã€msg.senderã¨quantityãŒãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«ç™»éŒ²ã•ã‚Œã€æ‰¿èªã•ã‚ŒãŸå ´åˆï¼‰ã€æŒ‡å®šã•ã‚ŒãŸæ•°é‡ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒ‡å®šã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç™ºè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```sol
import '@openzeppelin/contracts/token/ERC721/ERC721.sol';
import '@openzeppelin/contracts/utils/Counters.sol';
import {MerkleProof} from '@openzeppelin/contracts/utils/cryptography/MerkleProof.sol';
...
function mint(uint256 quantity, bytes32[] calldata merkleProof) public {
    bytes32 node = keccak256(abi.encodePacked(msg.sender, quantity));
    require(MerkleProof.verify(merkleProof, merkleRoot, node), 'invalid proof');

    for (uint256 i = 0; i < quantity; i++) {
        uint256 tokenId = _tokenIds.current();
        _mint(msg.sender, tokenId);

        _tokenIds.increment();
    }
}
```

ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¿½åŠ ã‚„æ•°é‡ã®å¤‰æ›´ãªã©ã€é‹ç”¨ä¸Šã®èª²é¡Œã«å¯¾å‡¦ã™ã‚‹ãŸã‚ã«ã€æ–°ã—ãè¨ˆç®—ã•ã‚ŒãŸãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã‚’å†ç™»éŒ²ã™ã‚‹ãŸã‚ã®é–¢æ•°ãŒå°å…¥ã•ã‚Œã¦ã„ã¾ã™ã€‚ãŸã ã—ã€ã“ã®é–¢æ•°ã¯èª°ã§ã‚‚ç°¡å˜ã«æ›´æ–°ã§ãã¦ã—ã¾ã†ã¨å•é¡ŒãŒç”Ÿã˜ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€æ‚ªæ„ã‚’æŒã£ãŸãƒ¦ãƒ¼ã‚¶ãŒä¸æ­£ãªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã€ãã‚Œã«åŸºã¥ã„ã¦è¨ˆç®—ã•ã‚ŒãŸãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã‚’ç™»éŒ²ã™ã‚‹ãªã©ã®è¡Œç‚ºãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ã“ã‚Œã‚’é˜²ããŸã‚ã«ã€ã“ã®é–¢æ•°ã«ã¯`onlyOwner`ä¿®é£¾å­ãŒé©ç”¨ã•ã‚Œã€é–¢æ•°ã®å®Ÿè¡Œã«ã¯ã‚ªãƒ¼ãƒŠãƒ¼ã®èªè¨¼ãŒå¿…è¦ã§ã™ã€‚
```sol
import "@openzeppelin/contracts/access/Ownable.sol";
...
function setMerkleRoot(bytes32 _merkleRoot) public onlyOwner {
    merkleRoot = _merkleRoot;
}
```

ç¾åœ¨ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã‚’è¿”å´ã™ã‚‹ãŸã‚ã®é–¢æ•°ãŒå­˜åœ¨ã—ã¾ã™ã€‚ã“ã®é–¢æ•°ã¯ã‚ªãƒ¼ãƒŠãƒ¼ã®ã¿ãŒæ›´æ–°ã§ãã‚‹ä»•æ§˜ã¨ãªã£ã¦ã„ã¾ã™ãŒã€é‹ç”¨ä¸Šã®ç¢ºèªã‚„ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œãªã©ã€æƒ…å ±ã®å–å¾—ãŒå¿…è¦ãªéš›ã«æ´»ç”¨ã•ã‚Œã¾ã™ã€‚
```sol
function getMerkleRoot() external view returns (bytes32) {
    return merkleRoot;
}
```

https://github.com/ikmzkRo/WLAQ-mint/blob/main/contracts/WLAQ.sol

## ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
ãƒã‚§ãƒƒã‚¯é …ç›®ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚
| é …ç›®                  | èª¬æ˜                                                |
| ------------------------- | --------------------------------------------------- |
|ã€€ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤      | ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ERC721ã®åå‰ã¨ã‚·ãƒ³ãƒœãƒ«ãŠã‚ˆã³ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€‚   |
| ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã¯ã‚ªãƒ¼ãƒŠãƒ¼ã®ã¿æ›´æ–°å¯èƒ½            | é‹ç”¨ä¸Šã®å•é¡Œã§ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã€ã‚ªãƒ¼ãƒŠãƒ¼ã®ã¿ãŒãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã‚’æ›´æ–°ã§ãã‚‹ã“ã¨ã€‚ |
| ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«å¿œã˜ãŸãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ       | ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«ç™»éŒ²ã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã¨æ•°é‡ã«å¿œã˜ãŸå ´åˆã®ã¿ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡ŒãŒã§ãã‚‹ã“ã¨    |
| æ®‹é«˜ç¢ºèª           | ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«ç™»éŒ²ã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã¨æ•°é‡ã«å¿œã˜ãŸãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚ŒãŸã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹       |

https://github.com/ikmzkRo/WLAQ-mint/blob/main/test/WLAQ.ts

## ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼æ§‹ç¯‰ç”¨ã®é–¢æ•°
ãƒ†ã‚¹ãƒˆã®éš›ã«åˆ©ç”¨ã™ã‚‹åˆå›ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ã¨ã€å®Ÿéš›ã®é‹ç”¨æ™‚ã«ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã‚’å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚
```ts
const inputs = flug === 'default'
  ? await makeInputs(usernames, usersQuantity)
  : await makeInputs(usernamesOperation, usersQuantityOperation);
```

ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã‹ã‚‰ãƒªãƒ¼ãƒ•ã‚’ç”Ÿæˆã—ã€å„ã€…ã‚’ãƒãƒƒã‚·ãƒ¥åŒ–ã—ã¦ã„ãã“ã¨ã§ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚`getHexRoot()`ã‚’ä½¿ç”¨ã—ã¦ã€ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã®ãƒ«ãƒ¼ãƒˆãƒãƒƒã‚·ãƒ¥ã‚’å–å¾—ã§ãã¾ã™ã€‚ã¾ãŸã€`getHexProof(leaf)`ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€æŒ‡å®šã•ã‚ŒãŸãƒãƒ¼ãƒ‰ã‹ã‚‰ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã¾ã§ã®æœ€çŸ­çµŒè·¯ã§ã‚ã‚‹ãƒãƒ¼ã‚¯ãƒ«ãƒ—ãƒ«ãƒ¼ãƒ•ã‚’å–å¾—ã§ãã¾ã™ã€‚

```ts
import keccak256 from 'keccak256';
import { MerkleTree } from 'merkletreejs';
...
const leaves = makeLeaves(inputs);
const leavesValue = Object.values(leaves);
const merkleTree = new MerkleTree(leavesValue, keccak256, { sort: true });

const root = merkleTree.getHexRoot();
const proof = merkleTree.getHexProof(leaf);
```

https://github.com/ikmzkRo/WLAQ-mint/blob/main/utils/merkletree.ts

å®Ÿè¡Œçµæœ
:::details yarn run test
```
yarn run v1.22.21
$ hardhat test
Compiled 13 Solidity files successfully


  WLAQ
    Deployment
inputs [
  {
    address: '0x70997970C51812dc3A010C7d01b50e0d17dc79C8',
    quantity: 1
  },
  {
    address: '0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC',
    quantity: 2
  },
  {
    address: '0x90F79bf6EB2c4f870365E785982E1f101E93b906',
    quantity: 1
  }
]
leaves {
  '0x70997970C51812dc3A010C7d01b50e0d17dc79C8': '0x3f68e79174daf15b50e15833babc8eb7743e730bb9606f922c48e95314c3905c',
  '0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC': '0xd0583fe73ce94e513e73539afcb4db4c1ed1834a418c3f0ef2d5cff7c8bb1dee',
  '0x90F79bf6EB2c4f870365E785982E1f101E93b906': '0xb783e75c6c50486379cdb997f72be5bb2b6faae5b2251999cae874bc1b040af7'
}
leavesValue [
  '0x3f68e79174daf15b50e15833babc8eb7743e730bb9606f922c48e95314c3905c',
  '0xd0583fe73ce94e513e73539afcb4db4c1ed1834a418c3f0ef2d5cff7c8bb1dee',
  '0xb783e75c6c50486379cdb997f72be5bb2b6faae5b2251999cae874bc1b040af7'
]
proofs {
  '0x70997970C51812dc3A010C7d01b50e0d17dc79C8': [
    '0xb783e75c6c50486379cdb997f72be5bb2b6faae5b2251999cae874bc1b040af7',
    '0xd0583fe73ce94e513e73539afcb4db4c1ed1834a418c3f0ef2d5cff7c8bb1dee'
  ],
  '0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC': [
    '0xf92db5e3e1d6bed45d8e50fad47eddeb89c5453802b5cb6d944df2f3679da55c'
  ],
  '0x90F79bf6EB2c4f870365E785982E1f101E93b906': [
    '0x3f68e79174daf15b50e15833babc8eb7743e730bb9606f922c48e95314c3905c',
    '0xd0583fe73ce94e513e73539afcb4db4c1ed1834a418c3f0ef2d5cff7c8bb1dee'
  ]
}
      âœ” Should return correct name and symbol
    setMerkleRoot check
      âœ” [S] Should set the Merkle Root correctly by Contract deployer
The initial Merkle root at the time of contract deployment undefined
inputs [
  {
    address: '0x70997970C51812dc3A010C7d01b50e0d17dc79C8',
    quantity: 1
  },
  {
    address: '0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC',
    quantity: 2
  },
  {
    address: '0x90F79bf6EB2c4f870365E785982E1f101E93b906',
    quantity: 3
  },
  {
    address: '0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc',
    quantity: 4
  }
]
leaves {
  '0x70997970C51812dc3A010C7d01b50e0d17dc79C8': '0x3f68e79174daf15b50e15833babc8eb7743e730bb9606f922c48e95314c3905c',
  '0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC': '0xd0583fe73ce94e513e73539afcb4db4c1ed1834a418c3f0ef2d5cff7c8bb1dee',
  '0x90F79bf6EB2c4f870365E785982E1f101E93b906': '0x8d1187a2c5d69d9d0f6e6c8baf49c9549b9573585daef9b8634509e0cb8d99ae',
  '0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc': '0x9995999b4cf3fbeb689e3cc965ed87e72ff5cb0c750b5e16639e60ac50a9bdd4'
}
leavesValue [
  '0x3f68e79174daf15b50e15833babc8eb7743e730bb9606f922c48e95314c3905c',
  '0xd0583fe73ce94e513e73539afcb4db4c1ed1834a418c3f0ef2d5cff7c8bb1dee',
  '0x8d1187a2c5d69d9d0f6e6c8baf49c9549b9573585daef9b8634509e0cb8d99ae',
  '0x9995999b4cf3fbeb689e3cc965ed87e72ff5cb0c750b5e16639e60ac50a9bdd4'
]
proofs {
  '0x70997970C51812dc3A010C7d01b50e0d17dc79C8': [
    '0x8d1187a2c5d69d9d0f6e6c8baf49c9549b9573585daef9b8634509e0cb8d99ae',
    '0xec8cfb2be54f182816432181c8e4effe0db09107a1e3459b788f06fd9f3d599e'
  ],
  '0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC': [
    '0x9995999b4cf3fbeb689e3cc965ed87e72ff5cb0c750b5e16639e60ac50a9bdd4',
    '0x3c796d3f1fb5030d1d09ecb20dddc5da2479c52d99d12aef90b27fea8d7e6f45'
  ],
  '0x90F79bf6EB2c4f870365E785982E1f101E93b906': [
    '0x3f68e79174daf15b50e15833babc8eb7743e730bb9606f922c48e95314c3905c',
    '0xec8cfb2be54f182816432181c8e4effe0db09107a1e3459b788f06fd9f3d599e'
  ],
  '0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc': [
    '0xd0583fe73ce94e513e73539afcb4db4c1ed1834a418c3f0ef2d5cff7c8bb1dee',
    '0x3c796d3f1fb5030d1d09ecb20dddc5da2479c52d99d12aef90b27fea8d7e6f45'
  ]
}
      âœ” [R] Should not allow setting Merkle Root by Owner
      âœ” [R] Should not allow setting Merkle Root by notOwner
    mint
      âœ” Should allow whitelisted users to mint
      âœ” Should revert when users try to mint over allowed quantity
      âœ” Should revert when non-whitelisted users try to mint


  7 passing (926ms)

Done in 4.38s.npx hardhat verify --network goerli 0x9B97b7bDEFa32b9a26f1Cf27459bcC18281938Ac
```
:::

## ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã® Deployï¼†Verify
ã‚³ãƒãƒ³ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨`.env`ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚
| ã‚³ãƒãƒ³ãƒ‰                  | èª¬æ˜                                                |
| ------------------------- | --------------------------------------------------- |
| `npx hardhat run scripts/deploy.ts --network goerli`      | ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’goerliã«ãƒ‡ãƒ—ãƒ­ã‚¤   |
| `npx hardhat verify --network goerli CA`            | CAã«ã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸçµæœã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®š |

```js: .env
ALCHEMY_API_KEY = "XXXXX"
PRIVATE_KEY = "XXXXX"
ETHERSCAN_API_KEY = "XXXXX"
```

https://github.com/ikmzkRo/WLAQ-mint/blob/main/scripts/deploy.ts

# èª²é¡Œ
## ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œå¾Œã«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨æ•°é‡ã®çŠ¶æ…‹ã‚’æ›´æ–°ã§ãã¦ã„ãªã„
æ—¢ã«æŒ‡å®šã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã©ã‚Œã ã‘ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚ŒãŸã‹ã¨ã„ã†çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹æ©Ÿèƒ½ãŒä»Šå¾Œå¿…è¦ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã­ã€‚

ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã¿ã‚’ç™»éŒ²ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè£…ã¨ãªã‚Šã¾ã™ã€‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã—ãŸç›´å¾Œã€`whitelistClaimed`ã«`msg.sender`ãŒç™»éŒ²ã•ã‚Œã‚‹å½¢ã§ã™ã€‚
```sol
  function whitelistMint(bytes32[] calldata _merkleProof) public payable returns (uint256) {
      require(!whitelistClaimed[msg.sender], "Address already claimed");
      bytes32 leaf = keccak256(abi.encodePacked(msg.sender));
      require(
          MerkleProof.verify(_merkleProof, merkleRoot, leaf),
          "Invalid proof"
      );
      
      _tokenIds.increment();
      uint256 newTokenId = _tokenIds.current();
      _mint(msg.sender, newTokenId);

      whitelistClaimed[msg.sender] = true;
      
      return newTokenId;
  }
```

## ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã«å¯¾ã™ã‚‹requireãŒä¸è¶³ã—ã¦ã„ã‚‹
è¿½åŠ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ä»¥ä¸‹ã®é …ç›®ã‚’è€ƒæ…®ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

- ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ãªã„
- æ—¢ã«åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ã‚¯ãƒ«ãƒ«ãƒ¼ãƒˆã§ã‚ã‚‹

ã“ã‚Œã‚‰ã®æ¡ä»¶ã‚’è€ƒæ…®ã—ãŸå®Ÿè£…ã«ã‚ˆã‚Šã€ã‚ˆã‚Šå …ç‰¢ã§ã‚»ã‚­ãƒ¥ã‚¢ãªã‚·ã‚¹ãƒ†ãƒ ãŒæ§‹ç¯‰ã§ãã¾ã™ã€‚
```sol
require(root != NULL, "The root is not registered.");
require(!usedMerkleRoots[root], "This root has already used.");
```

# ãŠã¾ã‘
ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼ã‚’ç”¨ã„ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚„å®Ÿè£…ä¾‹ã‚’è²¼ã£ã¦ãŠãã¾ã™ã€‚

https://zenn.dev/ryo_takahashi/scraps/ff70f43eb45856#comment-40095f6a46ae37
https://zenn.dev/serinuntius/articles/35c1b6a042174e847766?redirected=1
https://zenn.dev/serinuntius/articles/f56b3dc2871a03?redirected=1
https://zenn.dev/no_plan/articles/581be4ad731a79#merkle-proof%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B
https://zenn.dev/0xywzx/articles/bdb6c991f3fc8b

# æ„Ÿæƒ³
- ãƒãƒ¼ã‚¯ãƒ«ãƒ„ãƒªãƒ¼å¤§å¥½ã
- NFTã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªé…å¸ƒã‚’ç›®ã®å½“ãŸã‚Šã«ã—ãŸã„
- [zkRollup](https://zenn.dev/serinuntius/articles/f56b3dc2871a03?redirected=1#zkrollup%E3%82%92%E6%8E%98%E3%82%8A%E4%B8%8B%E3%81%92%E3%82%8B) ã®ç†è§£ã«è‹¦ã—ã‚“ã§ã„ã‚‹ã€‚ZKPã¯ãƒ›ãƒƒãƒˆãªè©±é¡Œãªã®ã§ç†è§£ã‚’é€²ã‚ã¦ã„ãã€‚

# å‚è€ƒ
https://dev.to/peterblockman/understand-merkle-tree-by-making-a-nft-minting-whitelist-1148#validate-data-using-merkle-tree
https://github.com/learn-co-students/session7-jsong-programming-blockchain-demo/blob/master/index.ipynb
https://zenn.dev/sakuracase/articles/4f58609f3da6e8
https://alis.to/gaxiiiiiiiiiiii/articles/3dy7vLZn0g89